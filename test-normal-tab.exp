#\!/usr/bin/expect -f

set timeout 5

# Create test data
exec echo {{"test": "value", "testing": "another"}} > /tmp/test.json

# Start jsq in NORMAL mode (without --prompts)
spawn node dist/index.js --file /tmp/test.json

expect "Type .help"
expect ">"

# Type $.t and press tab
send "$.t\t"

# Wait a bit
sleep 0.5

# Check what we got
expect {
    "$.test" {
        puts "✓ Tab completion worked in normal mode\!"
    }
    timeout {
        puts "✗ No completion in normal mode"
    }
}

# Exit
send ".exit\r"
expect eof

exec rm -f /tmp/test.json
