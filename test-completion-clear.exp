#!/usr/bin/expect -f

set timeout 5

# Create test data
exec echo {{"test": "value"}} > /tmp/test.json

# Start jsq in prompts mode
spawn node dist/index.js --file /tmp/test.json --prompts

expect "Welcome to jsq REPL"
expect -re {\?.*>}

puts "\n=== Testing completion status clear ==="

# Type $.t and press tab
send "$.t\t"
sleep 0.5

puts "After tab - looking for completion status..."

# Wait and capture output
expect -re {.*} {
    puts "Current output: $expect_out(buffer)"
}

# Now type 'x' 
puts "\nTyping 'x' to clear completion..."
send "x"
sleep 0.5

# Check the output again
expect -re {.*} {
    puts "After typing x: $expect_out(buffer)"
}

# Exit
send "\x03\x03"
expect eof

exec rm -f /tmp/test.json