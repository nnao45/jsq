#!/usr/bin/expect -f

set timeout 10

# JSONデータを用意
spawn sh -c "echo '{\"a\": 1, \"b\": 2}' | node dist/index.js --verbose"

# REPLプロンプトを待つ
expect ">"

# 式を入力（文字を1つずつ送る）
send "$"
expect "$"
send "."
expect "."
send "a"
expect "a"
send "\r"

# 結果を確認
expect {
    "1" {
        puts "\n✓ Result displayed: 1"
    }
    timeout {
        puts "\n✗ No result displayed"
    }
}

# もう一つ試す
send "$.b + 10\r"

expect {
    "12" {
        puts "✓ Result displayed: 12"
    }
    timeout {
        puts "✗ No result displayed"
    }
}

# 終了
send "\x03"
expect eof